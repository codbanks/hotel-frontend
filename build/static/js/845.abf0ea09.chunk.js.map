{"version":3,"file":"static/js/845.abf0ea09.chunk.js","mappings":"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","sources":["pages/reports/StaffDebtors.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport api from '../../api/api';\r\nimport '../../styles/StaffDebtors.css';\r\n\r\nconst formatMoney = (val) => {\r\n    if (typeof val !== 'number') return '-';\r\n    return `$ ${val.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\r\n};\r\n\r\nconst StaffDebtors = () => {\r\n    // 1. Manage the Date for the Report\r\n    const [reportDate, setReportDate] = useState(new Date().toISOString().split(\"T\")[0]);\r\n    const [rawInvoices, setRawInvoices] = useState([]);\r\n    const [rawLines, setRawLines] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // 2. Fetch real data from your StaffInvoice backend\r\n    const fetchData = useCallback(async () => {\r\n        setLoading(true);\r\n        try {\r\n            const [invRes, linesRes] = await Promise.all([\r\n                api.get(\"/staff-invoice/invoices/\"),\r\n                api.get(\"/staff-invoice/lines/\")\r\n            ]);\r\n            setRawInvoices(invRes.data);\r\n            setRawLines(linesRes.data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load staff records:\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [fetchData]);\r\n\r\n    // 3. Navigation Logic (Next / Prev Day)\r\n    const handleNavigate = (days) => {\r\n        const d = new Date(reportDate);\r\n        d.setDate(d.getDate() + days);\r\n        setReportDate(d.toISOString().split(\"T\")[0]);\r\n    };\r\n\r\n    // 4. THE CALCULATION ENGINE (Dynamic grouping by Staff Name)\r\n    const { processedData, totals } = useMemo(() => {\r\n        const startOfMonth = new Date(reportDate);\r\n        startOfMonth.setDate(1);\r\n        const startOfMonthStr = startOfMonth.toISOString().split(\"T\")[0];\r\n\r\n        let d_sales_t = 0;\r\n        let d_disc_t = 0;\r\n        let d_total_t = 0;\r\n        let m_sales_t = 0;\r\n\r\n        // Group by Name: Only show staff who actually have invoices in the system\r\n        const staffMap = {};\r\n\r\n        rawInvoices.forEach(inv => {\r\n            const name = inv.staff_name;\r\n            if (!staffMap[name]) {\r\n                staffMap[name] = { name, d_sales: 0, d_disc: 0, m_sales: 0 };\r\n            }\r\n\r\n            // Find all lines belonging to this specific invoice\r\n            const invoiceLines = rawLines.filter(line => line.invoice === inv.id);\r\n\r\n            invoiceLines.forEach(line => {\r\n                const amt = parseFloat(line.amount || 0);\r\n\r\n                // Daily Sales Logic\r\n                if (line.date === reportDate) {\r\n                    staffMap[name].d_sales += amt;\r\n                }\r\n\r\n                // Month to Date Logic (From 1st of month to currently viewed date)\r\n                if (line.date >= startOfMonthStr && line.date <= reportDate) {\r\n                    staffMap[name].m_sales += amt;\r\n                }\r\n            });\r\n        });\r\n\r\n        const processed = Object.values(staffMap).map(row => {\r\n            const rowTotal = row.d_sales - row.d_disc;\r\n            \r\n            // Accumulate Grand Totals for Footer\r\n            d_sales_t += row.d_sales;\r\n            d_disc_t += row.d_disc;\r\n            d_total_t += rowTotal;\r\n            m_sales_t += row.m_sales;\r\n\r\n            return { ...row, d_total: rowTotal };\r\n        });\r\n\r\n        return {\r\n            processedData: processed,\r\n            totals: { d_sales: d_sales_t, d_disc: d_disc_t, d_total: d_total_t, m_sales: m_sales_t }\r\n        };\r\n    }, [rawInvoices, rawLines, reportDate]);\r\n\r\n    return (\r\n        <div className=\"debtors-container\">\r\n            <header className=\"debtors-header\">\r\n                <div className=\"header-info\">\r\n                    <h3>Staff Debtors Report</h3>\r\n                    <span className=\"date-tag\">{reportDate}</span>\r\n                </div>\r\n\r\n                {/* --- NAVIGATION BUTTONS --- */}\r\n                <div className=\"report-controls\">\r\n                    <button className=\"nav-btn\" onClick={() => handleNavigate(-1)}>◀ Previous Date</button>\r\n                    <button className=\"nav-btn\" onClick={() => handleNavigate(1)}>Next Date ▶</button>\r\n                    <button className=\"refresh-btn\" onClick={fetchData}>↻ Refresh</button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"table-responsive\">\r\n                <table className=\"debtors-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th rowSpan=\"2\" className=\"text-left\">Name</th>\r\n                            <th colSpan=\"3\" className=\"group-head\">{reportDate} (Actual)</th>\r\n                            <th className=\"group-head\">Month To Date</th>\r\n                        </tr>\r\n                        <tr className=\"sub-head\">\r\n                            <th>Sales Actual</th>\r\n                            <th>Discount Amt</th>\r\n                            <th>Total</th>\r\n                            <th>Sales Actual</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {loading ? (\r\n                            <tr><td colSpan=\"5\" className=\"status-cell\">Updating report records...</td></tr>\r\n                        ) : processedData.length > 0 ? (\r\n                            processedData.map((row, idx) => (\r\n                                <tr key={idx}>\r\n                                    <td className=\"text-left name-col\">{row.name}</td>\r\n                                    <td className=\"numeric\">{row.d_sales === 0 ? '-' : formatMoney(row.d_sales)}</td>\r\n                                    <td className=\"numeric\">{row.d_disc === 0 ? '-' : formatMoney(row.d_disc)}</td>\r\n                                    <td className=\"numeric bold-col\">{row.d_total === 0 ? '-' : formatMoney(row.d_total)}</td>\r\n                                    <td className=\"numeric\">{formatMoney(row.m_sales)}</td>\r\n                                </tr>\r\n                            ))\r\n                        ) : (\r\n                            <tr><td colSpan=\"5\" className=\"status-cell\">No transactions found for this date.</td></tr>\r\n                        )}\r\n                    </tbody>\r\n                    <tfoot>\r\n                        <tr className=\"grand-total\">\r\n                            <td className=\"text-left\">TOTAL</td>\r\n                            <td className=\"numeric\">{formatMoney(totals.d_sales)}</td>\r\n                            <td className=\"numeric\">{formatMoney(totals.d_disc)}</td>\r\n                            <td className=\"numeric\">{formatMoney(totals.d_total)}</td>\r\n                            <td className=\"numeric highlight\">{formatMoney(totals.m_sales)}</td>\r\n                        </tr>\r\n                    </tfoot>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StaffDebtors;"],"names":["formatMoney","val","concat","toLocaleString","minimumFractionDigits","maximumFractionDigits","StaffDebtors","reportDate","setReportDate","useState","Date","toISOString","split","rawInvoices","setRawInvoices","rawLines","setRawLines","loading","setLoading","fetchData","useCallback","async","invRes","linesRes","Promise","all","api","get","data","err","console","error","useEffect","handleNavigate","days","d","setDate","getDate","processedData","totals","useMemo","startOfMonth","startOfMonthStr","d_sales_t","d_disc_t","d_total_t","m_sales_t","staffMap","forEach","inv","name","staff_name","d_sales","d_disc","m_sales","filter","line","invoice","id","amt","parseFloat","amount","date","Object","values","map","row","rowTotal","_objectSpread","d_total","_jsxs","className","children","_jsx","onClick","rowSpan","colSpan","length","idx"],"sourceRoot":""}